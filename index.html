<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Es Teh Tracker</title>
  <style>
    /* === CSS TIDAK BERUBAH DARI PERMINTAAN === */
    body { font-family: sans-serif; padding: 16px; max-width: 480px; margin: auto; }
    h2 { text-align: center; }
    .menu { display: flex; align-items: center; justify-content: space-between; margin: 12px 0; border-bottom: 1px solid #eee; padding-bottom: 8px;}
    .controls { display: flex; gap: 8px; align-items: center; }
    button { width: 36px; height: 36px; font-size: 18px; cursor: pointer; }
    .price { width: 90px; text-align: right; font-size: 14px; }
    .total { margin-top: 20px; font-weight: bold; text-align: right; font-size: 18px; }
    
    /* Tombol Simpan dengan Style Loading */
    .simpan {
      width: 100%; margin-top: 20px; padding: 12px; font-size: 16px; 
      background-color: #28a745; color: white; border: none; border-radius: 4px; cursor: pointer;
    }
    .simpan:hover { background-color: #218838; }
    .simpan:disabled { background-color: #ccc; cursor: not-allowed; }
  </style>
</head>
<body>

<h2>Penjualan Hari Ini</h2>

<div id="menu-list"></div>

<hr>

<div class="total">
  TOTAL: <span id="grand-total">Rp 0</span>
</div>

<button class="simpan" id="btn-simpan" onclick="simpanKeSheet()">SIMPAN</button>

<script>
// ================= 1. CONFIG MENU (LEBIH RAPI) =================
// Menggunakan Array of Objects -> Lebih standar untuk database
const products = [
  { id: 'ori',   name: "Es Teh Original", price: 3000 },
  { id: 'hijau', name: "Es Teh Hijau", price: 5000 },
  { id: 'susu',  name: "Es Teh Susu", price: 7000 },
  { id: 'lemon', name: "Es Teh Lemon", price: 6000 },
  { id: 'leci',  name: "Es Teh Leci", price: 6000 }// Gampang nambah menu
];

// Formatter Rupiah (Biar otomatis jadi Rp 5.000)
const rupiah = new Intl.NumberFormat("id-ID", {
  style: "currency",
  currency: "IDR",
  maximumFractionDigits: 0
});

// ================= 2. STATE MANAGEMENT =================
// Kita buat object kosong untuk menampung jumlah pesanan
// Hasilnya nanti: { ori: 0, hijau: 0, susu: 0, ... }
let cart = {};
products.forEach(p => cart[p.id] = 0);

// ================= 3. RENDER UI =================
const menuContainer = document.getElementById("menu-list");

function renderMenu() {
  menuContainer.innerHTML = ""; // Bersihkan dulu
  
  products.forEach(item => {
    const qty = cart[item.id];
    const subtotal = qty * item.price;
    
    const div = document.createElement("div");
    div.className = "menu";
    div.innerHTML = `
      <span>${item.name}</span>
      <div class="controls">
        <button onclick="updateQty('${item.id}', -1)">-</button>
        <span style="width: 20px; text-align:center;">${qty}</span>
        <button onclick="updateQty('${item.id}', 1)">+</button>
      </div>
      <span class="price">${rupiah.format(subtotal)}</span>
    `;
    menuContainer.appendChild(div);
  });
  
  updateGrandTotal();
}

// ================= 4. LOGIC UPDATE =================
function updateQty(id, change) {
  if (cart[id] + change >= 0) {
    cart[id] += change;
    renderMenu(); // Re-render agar tampilan update
  }
}

function updateGrandTotal() {
  let total = 0;
  products.forEach(p => {
    total += cart[p.id] * p.price;
  });
  document.getElementById("grand-total").innerText = rupiah.format(total);
}

// ================= 5. GOOGLE SHEET INTEGRATION =================
const API_URL = "https://script.google.com/macros/s/AKfycbwgs70hSlbquLwkWRsFAsAUluf5GiCYxoWiAIXf2qAQCib5J4RHgU_J1S_5S5KNhKk6/exec";

async function simpanKeSheet() {
  const btn = document.getElementById("btn-simpan");
  
  // 1. Filter: Hanya ambil item yang jumlahnya > 0
  const transaksi = products
    .filter(p => cart[p.id] > 0)
    .map(p => ({
      tanggal: new Date().toLocaleString("id-ID"), // Waktu otomatis
      produk: p.name,
      qty: cart[p.id],
      harga: p.price,
      total: cart[p.id] * p.price
    }));

  if (transaksi.length === 0) {
    alert("Belum ada pesanan yang diinput!");
    return;
  }

  // 2. Loading State (UX)
  btn.innerText = "Menyimpan...";
  btn.disabled = true;

  try {
    // 3. Kirim SATU request berisi Array Transaksi
    await fetch(API_URL, {
      method: "POST",
      body: JSON.stringify({ data: transaksi }) // Bungkus dalam object 'data'
    });

    // 4. Reset jika sukses
    alert("Data berhasil masuk Google Sheet!");
    products.forEach(p => cart[p.id] = 0); // Reset qty
    renderMenu(); // Reset tampilan

  } catch (err) {
    console.error(err);
    alert("Gagal menyimpan! Cek koneksi internet.");
  } finally {
    // Kembalikan tombol
    btn.innerText = "SIMPAN";
    btn.disabled = false;
  }
}

// Render awal saat halaman dibuka
renderMenu();
</script>

</body>
</html>